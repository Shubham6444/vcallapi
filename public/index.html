<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoom Clone</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=DM+Sans:400,500,700&display=swap" rel="stylesheet">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    button {
      outline: none;
      transition: .2s;
      cursor: pointer;

      &:hover {
        opacity: .7;
      }
    }

    body {
      --app-background: #eaebf5;
      --chat-background: #fff;
      --link-color: #c0c1c5;
      --navigation-bg: #fff;
      --navigation-box-shadow: 0 2px 6px 0 rgba(136, 148, 171, 0.2), 0 24px 20px -24px rgba(71, 82, 107, 0.1);
      --main-color: #3d42df;
      --message-bg: #f3f4f9;
      --message-bg-2: #3d42df;
      --message-text: #2c303a;
      --placeholder-text: #a2a4bc;
      --button-bg: #fff;
    }

    body.dark {
      --app-background: #262a42;
      --navigation-box-shadow: 0px 0px 8px 0px #282b33;
      --chat-background: #3c3f56;
      --message-bg: #2c3046;
      --message-text: rgba(255, 255, 255, 0.8);
      --placeholder-text: #fff;
      --navigation-bg: #3c3f56;
      --button-bg: #3c3f56;
      --main-color: #6f74ff;
      --message-bg-2: #6f74ff;

      .mic {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-mic-off' viewBox='0 0 24 24'%3E%3Cpath d='M1 1l22 22M9 9v3a3 3 0 005.12 2.12M15 9.34V4a3 3 0 00-5.94-.6'/%3E%3Cpath d='M17 16.95A7 7 0 015 12v-2m14 0v2a7 7 0 01-.11 1.23M12 19v4M8 23h8'/%3E%3C/svg%3E%0A");
      }

      .camera {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-camera-off' viewBox='0 0 24 24'%3E%3Cpath d='M1 1l22 22M21 21H3a2 2 0 01-2-2V8a2 2 0 012-2h3m3-3h6l2 3h4a2 2 0 012 2v9.34m-7.72-2.06a4 4 0 11-5.56-5.56'/%3E%3C/svg%3E%0A");
      }

      

      .magnifier {
        color: #fff;
      }

      .chat-header {
        border-color: var(--message-bg);
      }

      .btn-close-right {
        color: #fff;
      }
    }

    a {
      text-decoration: none;
    }

    .app-container {
      background-color: var(--app-background);
      width: 100%;
      height: 100%;
      font-family: 'DM Sans', sans-serif;
      display: flex;
      transition: .2s;
    }

    .left-side {
      position: relative;
      padding: 16px;
      flex-basis: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }

    .navigation {
      display: flex;
      flex-direction: column;
      background-color: var(--navigation-bg);
      padding: 24px;
      border-radius: 10px;
      box-shadow: var(--navigation-box-shadow);
    }

    .nav-link+.nav-link {
      margin-top: 32px;
    }

    .nav-link:hover svg {
      color: #3d42df;
    }

    .icon svg {
      width: 24px;
      height: 24px;
      color: var(--link-color);
      transition: .2s ease-in;
    }

    .right-side {
      margin-left: auto;
      flex-basis: 400px;
      height: 100%;
      padding: 16px;
      position: relative;
      transition: all 300ms cubic-bezier(0.190, 1.000, 0.560, 1.000);

      &.show {
        display: block;
        transform: translateX(0);
      }
    }

    .chat-container {
      background-color: var(--chat-background);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      height: calc(100% - 72px);
    }

    .chat-header {
      padding: 16px;
      border-bottom: 1px solid #f5f5f5;
    }

    .chat-header-button {
      background-color: var(--main-color);
      padding: 12px 16px 12px 40px;
      border: none;
      border-radius: 4px;
      color: #fff;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M479.9 187.52l-90.19 68.53v-52.6a20 20 0 00-20-20H20a20 20 0 00-20 20V492a20 20 0 0020 20h349.71a20 20 0 0020-20v-52.6l90.18 68.52c13.05 9.91 32.1.67 32.1-15.92V203.45c0-16.5-18.94-25.92-32.1-15.93zM349.7 472H40V223.45h309.71zM472 451.68l-82.29-62.53V306.3L472 243.77zM87.96 79.24C129.62 28.88 190.86 0 256 0c65.13 0 126.37 28.88 168.03 79.24a20 20 0 01-30.82 25.5A177.6 177.6 0 00256 40a177.6 177.6 0 00-137.21 64.73 20 20 0 11-30.83-25.5zm240.36 32.21a20 20 0 11-21.02 34.03 97.57 97.57 0 00-51.3-14.53 97.6 97.6 0 00-51.31 14.53 20 20 0 11-21.02-34.03A137.53 137.53 0 01256 90.95c25.59 0 50.6 7.09 72.32 20.5zm0 0'/%3E%3C/svg%3E%0A");
      background-repeat: no-repeat;
      background-position: center left 12px;
      background-size: 16px;
      font-size: 14px;
    }

    .chat-area {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .profile-picture {
      border-radius: 8px;
      width: 32px;
      height: 32px;
      overflow: hidden;
      margin-right: 12px;
      flex-shrink: 0;

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }

    .message-wrapper {
      display: flex;
    }

    .name {
      margin: 0;
      line-height: 16px;
      font-size: 12px;
      font-weight: 700;
      color: var(--message-text);
    }

    .message-content div {
      margin-top: 8px;

      padding: 8px 16px;
      border-radius: 0 12px 12px 12px;
      font-size: 12px;
      line-height: 16px;

      color: var(--message-text);
      padding: 10px;
    }

    .message-wrapper {
      padding: 16px 0;

      &.reverse {
        flex-direction: row-reverse;

        .message {
          background-color: var(--message-bg-2);
          color: #fff;
          margin-left: auto;
          border-radius: 16px 0px 16px 16px;
        }

        .profile-picture {
          margin-right: 0px;
          margin-left: 12px;
        }

        .name {
          text-align: right;
        }
      }
    }

    .message-file {
      border: 1px solid var(--message-bg);
      width: 100%;
      margin-top: 16px;
      border-radius: 4px;
      padding: 8px;
      display: flex;

      .sketch {
        border-radius: 4px;
        padding: 2px;
        background-color: #fdeee2;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 32px;
        height: 32px;

        svg {
          width: 20px;
          height: 20px;
        }
      }
    }

    .file-info {
      flex: 1;
      padding: 0 40px 0 8px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='%23b8b8b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-download' viewBox='0 0 24 24'%3E%3Cpath d='M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3'/%3E%3C/svg%3E%0A");
      background-position: center right 12px;
      background-size: 20px;
      background-repeat: no-repeat;
      font-size: 12px;
    }

    .file-name {
      color: var(--message-text);
    }

    .file-size {
      color: #b8b8b8;
    }

    .mention {
      color: #7c80fd;
    }

    .chat-typing-area-wrapper {
      padding: 16px;
    }

    .chat-typing-area {
      display: flex;
      border-radius: 10px;
      padding: 8px;
      box-shadow: var(--navigation-box-shadow);
      background-color: var(--message-bg);

      .dark & {
        box-shadow: none;
      }
    }

    .chat-input {
      border: none;
      font-size: 14px;
      line-height: 24px;
      outline: none;
      color: var(--message-text);
      flex: 1;
      background-color: transparent;

      &:placeholder {
        color: var(--placeholder-text);
      }
    }

    .send-button {
      color: #fff;
      background-color: var(--main-color);
      border-radius: 8px;
      border: none;
      width: 32px;
      height: 32px;
      display: flex;
      justify-content: center;
      align-items: center;

      svg {
        width: 20px;
        height: 20px;
      }
    }

    .app-main {

      width: 100%;
      padding: 72px 32px 16px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      
    }

    .video-call-wrapper {
      width: 100%;
      height: 100%;
      border-radius: 16px;
      overflow: auto;
     display: flex;
      padding: 20px;
     

    }

    .video-participant {background-color: red;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 80px;
      height: 100px;
      background: rgb(122, 252, 133);
      border-radius: 8px;
      box-sizing: border-box;
      margin: 6px;
    }

    .video- pant {

      margin: 1px;
    }

    .name-tag {
      position: absolute;
      bottom: 12px;
      right: 12px;
      font-size: 12px;
      color: #fff;
      background-color: rgba(0, 15, 47, 0.5);
      border-radius: 4px;
      padding: 4px 12px;
    }

    .participant-actions {
      position: absolute;
      display: flex;
      left: 12px;
      top: 12px;
    }

    .btn-mute,
    .btn-camera {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      background-color: rgba(0, 15, 47, 0.5);
      background-repeat: no-repeat;
      background-position: center;
      background-size: 16px;
      border: none;
    }

    .btn-mute {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-mic-off' viewBox='0 0 24 24'%3E%3Cpath d='M1 1l22 22M9 9v3a3 3 0 005.12 2.12M15 9.34V4a3 3 0 00-5.94-.6'/%3E%3Cpath d='M17 16.95A7 7 0 015 12v-2m14 0v2a7 7 0 01-.11 1.23M12 19v4M8 23h8'/%3E%3C/svg%3E%0A");
      margin-right: 4px;
    }

    .btn-camera {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-camera-off' viewBox='0 0 24 24'%3E%3Cpath d='M1 1l22 22M21 21H3a2 2 0 01-2-2V8a2 2 0 012-2h3m3-3h6l2 3h4a2 2 0 012 2v9.34m-7.72-2.06a4 4 0 11-5.56-5.56'/%3E%3C/svg%3E%0A");
    }

    .video-call-actions {
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 64px;
      max-width: 500px;
    }

    .video-action-button {     

      background-repeat: no-repeat;
      background-size: 24px;
      border: none;
      height: 48px;
      margin: 0 8px;
      box-shadow: var(--navigation-box-shadow);
      border-radius: 8px;
      width: 48px;
      cursor: pointer;
      outline: none;
      background-color: var(--button-bg);
      background-color: #7aff5f;
      &.mic {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='%232c303a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-mic-off' viewBox='0 0 24 24'%3E%3Cpath d='M1 1l22 22M9 9v3a3 3 0 005.12 2.12M15 9.34V4a3 3 0 00-5.94-.6'/%3E%3Cpath d='M17 16.95A7 7 0 015 12v-2m14 0v2a7 7 0 01-.11 1.23M12 19v4M8 23h8'/%3E%3C/svg%3E%0A");
        background-position: center;
      }

      &.camera {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='%232c303a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-camera-off' viewBox='0 0 24 24'%3E%3Cpath d='M1 1l22 22M21 21H3a2 2 0 01-2-2V8a2 2 0 012-2h3m3-3h6l2 3h4a2 2 0 012 2v9.34m-7.72-2.06a4 4 0 11-5.56-5.56'/%3E%3C/svg%3E%0A");
        background-position: center;
      }

      &.maximize {
        background-image: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20id%3D%22screen-share%22%3E%3Cpath%20fill%3D%22none%22%20d%3D%22M0%200h24v24H0V0z%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M20%2018c1.1%200%201.99-.9%201.99-2L22%206a2%202%200%200%200-2-2H4c-1.11%200-2%20.89-2%202v10a2%202%200%200%200%202%202H0v2h24v-2h-4zM4%2016V6h16v10.01L4%2016zm9-6.87c-3.89.54-5.44%203.2-6%205.87%201.39-1.87%203.22-2.72%206-2.72v2.19l4-3.74L13%207v2.13z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E');

        background-position: center;
      }

      &.endcall {
        color: #ff1932;
        width: auto;
        font-size: 14px;
        padding-left: 42px;
        padding-right: 12px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff1932' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-phone-missed'%3E%3Cline x1='23' y1='1' x2='17' y2='7'/%3E%3Cline x1='17' y1='1' x2='23' y2='7'/%3E%3Cpath d='M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z'/%3E%3C/svg%3E");
        background-size: 20px;
        background-position: center left 12px;
      }

      &.magnifier {
        padding: 0 12px;
        display: flex;
        align-items: center;
        width: auto;
        flex-grow: 0;
        color: #2c303a;

        svg {
          width: 20px;
          flex-shrink: 0;
        }

        span {
          display: block;
          margin: 0 16px;
        }
      }
    }

    .participants {
      display: flex;
      background-color: var(--button-bg);
      box-shadow: var(--navigation-box-shadow);
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      max-width: 232px;
      margin-left: auto;
    }

    .participant-more {
      background-color: #e1e0e1;
      font-size: 14px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #636181;
      font-weight: 700;
      border-radius: 8px;
      min-width: 32px;
    }

    .mode-switch {
      z-index: 1;
      position: absolute;
      top: 20px;
      left: 36px;
      background-color: var(--chat-background);
      border: none;
      color: #ddd;
      outline: none;
      cursor: pointer;
      box-shadow: var(--navigation-box-shadow);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 36px;
      height: 36px;
      transform-origin: center;

      svg {
        width: 0;
        height: 24px;
        transition: all .3s ease-in;
        transform-origin: center;
      }

      .moon {
        opacity: 0;
      }

      .sun {
        width: 24px;
      }
    }

    .dark .moon {
      opacity: 1;
      width: 24px;
    }

    .dark .sun {
      opacity: 0;
      width: 0;
    }

    .expand-btn {
      position: absolute;
      right: 32px;
      top: 24px;
      border: none;
      background-color: var(--chat-background);
      border-radius: 4px;
      padding: none;
      color: var(--message-text);
      width: 40px;
      height: 40px;
      justify-content: center;
      align-items: center;

      display: none;

      &.show {
        display: flex;
      }
    }

    .btn-close-right {
      border: none;
      background-color: transparent;
      position: absolute;
      top: 24px;
      right: 24px;
      color: var(--light-font);
      outline: none;
      cursor: pointer;

      display: none;
    }

    @media screen and (max-width: 900px) {
      .expand-btn {
        display: block;
      }

      .right-side {
        position: absolute;
        right: 0px;
        background-color: var(--chat-background);
        transform: translateX(100%);
        z-index: 2;
        width: 100%;
        display: none;

        &.show {
          transform: translateX(0);
        }
      }

      .btn-close-right {
        display: block;
      }
    }

    @media screen and (max-width: 520px) {
      .left-side {
        display: none;
      }

      .app-main {
        padding: 72px 16px 16px 16px;
      }

      .expand-btn {
        right: 16px;
      }

      .mode-switch {
        left: 16px;
      }

      .video-call-actions {
        padding-top: 32px;
      }

      .video-action-button {
        width: 45px;
        height: 45px;
        background-size: 14px;
        margin: 0 4px;
      }

      .video-action-button.endcall {
        background-size: 14px;
        font-size: 12px;
        padding-left: 36px;
      }

      .video-action-button.magnifier svg {
        width: 14px;
      }

      .video-action-button.magnifier span {
        margin: 0 4px;
        font-size: 12px;
      }
    }

    #videoExpent {
      width: 100%;
      height: 4rem;
      border: 1px solid white;
      object-fit: cover;
      /* This ensures the video covers the area of the container */
    }


    .userviwe {
      
      width: 40px;
      height: 40px;
      border-radius: 50%;
      justify-content: center;
      align-items: center;
      display: flex;
      margin: 5px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' width='20px' height='20px' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-mic-off' viewBox='0 0 24 24'%3E%3Cpath d='M1 1l22 22M9 9v3a3 3 0 005.12 2.12M15 9.34V4a3 3 0 00-5.94-.6'/%3E%3Cpath d='M17 16.95A7 7 0 015 12v-2m14 0v2a7 7 0 01-.11 1.23M12 19v4M8 23h8'/%3E%3C/svg%3E%0A");
      background-repeat: no-repeat;
      background-position: center center;
      background-size: 20px 20px;
      /* Ensures the image fits well inside the circle */
      color: black;
      background-color: white;
    }
  </style>
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>





  <div class="app-container">
    <button class="mode-switch">
      <svg class="sun" fill="none" stroke="#fbb046" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        class="feather feather-sun" viewBox="0 0 24 24">
        <defs />
        <circle cx="12" cy="12" r="5" />
        <path
          d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
      </svg>
      <svg class="moon" fill="none" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        class="feather feather-moon" viewBox="0 0 24 24">
        <defs />
        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
      </svg>
    </button>
    <div class="left-side" id="draggableNav">
      <div class="navigation">
        <a href="#" class="nav-link icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" class="feather feather-home" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
            <path d="M9 22V12h6v10" />
          </svg>
        </a>
        <a href="#" class="nav-link icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="feather feather-message-square">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
          </svg>
        </a>
        <a href="#" class="nav-link icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone-call" viewBox="0 0 24 24">
            <path
              d="M15.05 5A5 5 0 0119 8.95M15.05 1A9 9 0 0123 8.94m-1 7.98v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z" />
          </svg>
        </a>
        <a href="#" class="nav-link icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="feather feather-hard-drive">
            <line x1="22" y1="12" x2="2" y2="12" />
            <path
              d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z" />
            <line x1="6" y1="16" x2="6.01" y2="16" />
            <line x1="10" y1="16" x2="10.01" y2="16" />
          </svg>
        </a>
        <a href="#" class="nav-link icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="feather feather-users">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
          </svg>
        </a>
        <a href="#" class="nav-link icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder" viewBox="0 0 24 24">
            <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z" />
          </svg>
        </a>
        <a href="#" class="nav-link icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3" />
            <path
              d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" />
          </svg>
        </a>
      </div>
    </div>
    <div class="app-main">
      <div class="video-call-wrapper" id="video-grid" style="background: #121420;">

        <div class="video-participant" data-user-id="You" style="background-color: #262a42;"><video id="videoExpent" autoplay="" style="display: none;"></video><p class="userviwe" data-user-id="You" style="box-shadow: none;"></p><div style="color: white; background-color: rgba(0, 0, 0, 0.5); padding: 5px;">You</div></div>

      </div>

      <div class="video-call-actions " id="buttona">
        <button class="video-action-button mic" onclick="toggleAudio()"></button>
        <button class="video-action-button camera" onclick="toggleVideo()"></button>
        <button class="video-action-button maximize" onclick="startScreenShare()"></button>
        <button class="video-action-button endcall" onclick="joinRoom()">Leave</button>
        <button class="video-action-button magnifier" onclick="stopScreenShare()">stop
       
<p id="toggleSpeaker"></p>
      </div>


    </div>
    <div class="right-side">
      <button class="btn-close-right">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
          stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="feather feather-x-circle"
          viewBox="0 0 24 24">
          <defs></defs>
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M15 9l-6 6M9 9l6 6"></path>
        </svg>
      </button>
      <div class="chat-container">
        <div class="chat-header">
          <button class="chat-header-button">
            Live Chat
          </button>
        </div>

        <div class="chat-area" id="allmessages">
         


        </div>
        <div class="chat-typing-area-wrapper">
          <div class="chat-typing-area">

            <input type="text" placeholder="Type your meesage..." class="chat-input" id="chat-input"
              onkeypress="sendMessage(event)">




            <button class="send-button">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" class="feather feather-send" viewBox="0 0 24 24">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
      <div class="participants">
        <div class="participant profile-picture">
          <img
            src="https://images.unsplash.com/photo-1576110397661-64a019d88a98?ixlib=rb-1.2.1&auto=format&fit=crop&w=1234&q=80"
            alt="pp">
        </div>
        <div class="participant profile-picture">
          <img
            src="https://images.unsplash.com/photo-1566821582776-92b13ab46bb4?ixlib=rb-1.2.1&auto=format&fit=crop&w=900&q=60"
            alt="pp">
        </div>
        <div class="participant profile-picture">
          <img
            src="https://images.unsplash.com/photo-1600207438283-a5de6d9df13e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1234&q=80"
            alt="pp">
        </div>
        <div class="participant profile-picture">
          <img
            src="https://images.unsplash.com/photo-1581824283135-0666cf353f35?ixlib=rb-1.2.1&auto=format&fit=crop&w=1276&q=80"
            alt="pp">
        </div>
        <div class="participant-more">2+</div>
      </div>
    </div>
    <button class="expand-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="feather feather-message-circle">
        <path
          d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
      </svg>
    </button>
  </div>
  <script>$(document).ready(function () {
      $('button.mode-switch').click(function () {
        $('body').toggleClass('dark');

      });

      $(".btn-close-right").click(function () {
        $(".right-side").removeClass("show");
        $(".expand-btn").addClass("show");
      });

      $(".expand-btn").click(function () {
        $(".right-side").addClass("show");
        $(this).removeClass("show");
      });
    });</script>





  <script>const socket = io({
    reconnection: true,
    reconnectionAttempts: 5,  // Set a number of attempts
    reconnectionDelay: 1000,  // Delay in ms between reconnection attempts
    reconnectionDelayMax: 5000,  // Maximum delay
    timeout: 20000  // Timeout in ms
});



let isFirstConnection = true;  // Track if it's the first connection

socket.on('connect', () => {
  console.log('Connected to server');
  
  if (!isFirstConnection) {
    // Only call joinRoom() after a reconnection
    joinRoom()
    console.log("ok")
  } else {console.log("no")
    // Set the flag to false after the first connection
    isFirstConnection = false;
  }
});

socket.on('reconnect_attempt', (attemptNumber) => {
    console.log(`Reconnection attempt #${attemptNumber}`);
});

socket.on('reconnect', () => {
    console.log('Reconnected to server');
    
});

socket.on('reconnect_failed', () => {
    console.log('Reconnection failed after all attempts');
});

socket.on('disconnect', (reason) => {
    console.log('Disconnected from server, reason:', reason);
});


        
    let localStream;
    let screenStream;
    let peerConnections = {};
    let room = null;
    const config = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };

    const videoGrid = document.getElementById('video-grid');
    const participantsList = document.getElementById('participants-list');
    const allmessages = document.getElementById('allmessages');

    const chatInput = document.getElementById('chat-input');

    let audioContext;
    let analyserNode;
    let microphoneStream;
    let threshold = 0.1; // Adjust this threshold based on the sensitivity

    async function joinRoom() {
      const roomName = "hi"; // this is temp
      if (roomName) {
        room = roomName;
        await setupLocalStream();
        socket.emit('join-room', room);
      }   
    

      setTimeout(() => {
        toggleVideo();
      }, 2000);
        }

    async function setupLocalStream() {
      try {
        localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        addVideoStream(localStream, 'You');

        // Set up audio context and analyser to detect voice activity
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyserNode = audioContext.createAnalyser();
        const sourceNode = audioContext.createMediaStreamSource(localStream);
        sourceNode.connect(analyserNode);

        // Monitor audio levels
        monitorAudioLevels();
      } catch (err) {
        console.error('Error accessing media devices.', err);
      }
    }
    function monitorAudioLevels() {
  const bufferLength = analyserNode.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);

  function checkAudioLevel() {
    analyserNode.getByteFrequencyData(dataArray);

    let total = 0;
    for (let i = 0; i < bufferLength; i++) {
      total += dataArray[i];
    }
    const average = total / bufferLength;

    if (average > threshold * 255) {
      highlightVideo("You"); // Highlight local video
      socket.emit("voice-activity", { userId: socket.id, room });
      
    } else {
      removeHighlight("You");
    }

    requestAnimationFrame(checkAudioLevel);
  }

  checkAudioLevel();
}
socket.on("voice-muted", ({ userId }) => {
  if (userId !== socket.id) {  // Ensure it doesn't highlight the local user
    const videoElement = document.querySelector(`.userviwe[data-user-id="${userId}"]`);

    // Check the current background color and toggle it
    if (videoElement.style.backgroundColor === "red") {
      videoElement.style.backgroundColor = "white";  // Toggle back to white
    } else {
      videoElement.style.backgroundColor = "red";   // Set to red
    }
  }
});
socket.on("voice-activity", ({ userId }) => {
  highlightVideo(userId);

  setTimeout(() => {
    removeHighlight(userId);
  }, 500);
});
    function highlightVideo(userId) {
      const videoElement = document.querySelector(`.userviwe[data-user-id="${userId}"]`);
      
      if (videoElement) {
        // Apply the visual effect, e.g., glowing border
        //videoElement.style.border = "5px solid rgba(0, 255, 0, 0.7)"; // Green border
videoElement.style.boxShadow = "0 0 20px pink, 0 0 40px rgba(252,70,107,1)";

      }
    }

    function removeHighlight(userId) {
      const videoElement = document.querySelector(`.userviwe[data-user-id="${userId}"]`);
      if (videoElement) {
        // Remove the visual effect
       // videoElement.style.border = "none";
        videoElement.style.boxShadow = "none"; // Glowing effect

      }
    }
    function addVideoStream(stream, userId) {
  const existingVideoContainer = document.querySelector(`.video-participant[data-user-id="${userId}"]`);
  if (existingVideoContainer) {
    existingVideoContainer.remove();
  }

  const videoContainer = document.createElement('div');
  videoContainer.className = 'video-participant';
  videoContainer.setAttribute('data-user-id', userId);
  const video = document.createElement('video');
  video.srcObject = stream;
  video.autoplay = true;
  video.controls = true;
  video.style.display='none';
  video.id = 'videoExpent';
  const label = document.createElement('div');
  const userp = document.createElement('p');
  userp.className = 'userviwe';
  userp.setAttribute('data-user-id', userId);

  // Pass video to the function for expanding
  userp.onclick = function () { videoExpand(video,videoContainer); };
  
  video.srcObject = stream;
  video.autoplay = true;
  video.playsinline = true;
  if (userId === 'You') video.muted = true;

  videoContainer.appendChild(video);

  label.textContent = userId.slice(0, 7);
  label.style.color = 'white';
  label.style.backgroundColor = 'rgba(0,0,0,0.5)';
  label.style.padding = '5px';
  videoContainer.appendChild(userp);
  videoContainer.appendChild(label);

  videoGrid.appendChild(videoContainer);
}
// Function to expand video when clicked
function videoExpand(video,videoContainer) {
    video.style.display = 'block';
    video.style.zIndex = '1000';
    videoContainer.style.width='300px';
    videoContainer.style.height='225px';

    video.style.width = '100%';  // Ensures the video takes up the full viewport width
    video.style.height = '100%';  // Ensures the video takes up the full viewport height
   
    video.style.border = '2px solid red';
    video.style.left = '0';
    video.style.top = '0';
    video.style.objectFit = 'contain';  // Makes sure the video is fully visible without cropping or zooming


    
  // Create close button
  const closeButton = document.createElement('button');
  closeButton.className = 'video-action-button magnifie';

  closeButton.innerHTML = '&times;';
  closeButton.style.color= "black";

  // Close overlay when clicked
  closeButton.addEventListener('click', () => {
    video.style.display="none";
    videoContainer.style.width='80px';
    videoContainer.style.height='100px';
    closeButton.remove();
  });
  const a = document.getElementById('buttona');

  a.appendChild(closeButton);
  

}


    // WebRTC Peer Connection Handling
    socket.on('user-connected', (userId) => {
      console.log('User connected:', userId);

      const pc = new RTCPeerConnection(config);
      peerConnections[userId] = pc;

      // Add local video tracks to the peer connection
      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

      // Handle ICE candidates
      pc.onicecandidate = (event) => {
        if (event.candidate) {
          socket.emit('ice-candidate', { userId, candidate: event.candidate });
        }
      };

      // Add remote stream to video container
      pc.ontrack = (event) => {
        addVideoStream(event.streams[0], userId);
      };

      // Create and send offer
      pc.createOffer()
        .then(offer => pc.setLocalDescription(offer))
        .then(() => {
          socket.emit('offer', { userId, offer: pc.localDescription });
        });
    });

    // Handle offer and send answer
    socket.on('offer', async ({ userId, offer }) => {
      const pc = new RTCPeerConnection(config);
      peerConnections[userId] = pc;

      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

      pc.onicecandidate = (event) => {
        if (event.candidate) {
          socket.emit('ice-candidate', { userId, candidate: event.candidate });
        }
      };

      pc.ontrack = (event) => {
        addVideoStream(event.streams[0], userId);
      };

      await pc.setRemoteDescription(new RTCSessionDescription(offer));
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      socket.emit('answer', { userId, answer: pc.localDescription });
    });

    // Handle answer from other user
    socket.on('answer', ({ userId, answer }) => {
      if (peerConnections[userId]) {
        peerConnections[userId].setRemoteDescription(new RTCSessionDescription(answer));
      }
    });

    // Handle ICE candidates
    socket.on('ice-candidate', ({ userId, candidate }) => {
      if (peerConnections[userId]) {
        peerConnections[userId].addIceCandidate(new RTCIceCandidate(candidate));
      }
    });

    // Handle user disconnection
    socket.on('user-disconnected', userId => {
      console.log('User disconnected:', userId);
      if (peerConnections[userId]) {
        peerConnections[userId].close();
        delete peerConnections[userId];
      }
      const videoElement = document.querySelector(`.video-participant[data-user-id="${userId}"]`);
      if (videoElement) {
        videoElement.remove();
      }
      const participantElement = document.getElementById(`participant-${userId}`);
      if (participantElement) {
        participantElement.remove();
      }
    });

    // Handle chat messages
    socket.on('chat-message', ({ sender, message }) => {
      addMessageToChat(sender, message);
    });







    function addMessageToChat(sender, message) {
      const messageElement = document.createElement('div');
      messageElement.className ='message-wrapper';

      messageElement.textContent = `${sender.slice(0,4)}: ${message}`;
      allmessages.appendChild(messageElement);
      allmessages.scrollTop = allmessages.scrollHeight;
    }

    function sendMessage(event) {
      if (event.key === 'Enter') {
        const message = chatInput.value;
        socket.emit('chat-message', { room, message });

        const messageElement = document.createElement('div');
        messageElement.className ='message-wrapper reverse';
      messageElement.textContent = `You : ${message}`;
      allmessages.appendChild(messageElement);
      allmessages.scrollTop = allmessages.scrollHeight;
       
        chatInput.value = '';
      }
    }

    // Start and stop screen sharing
    async function startScreenShare() {
      try {
        screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        const videoTrack = screenStream.getVideoTracks()[0];

        Object.values(peerConnections).forEach(pc => {
          const sender = pc.getSenders().find(s => s.track.kind === 'video');
          if (sender) {
            sender.replaceTrack(videoTrack);
          }
        });

        addVideoStream(screenStream, 'Your Screen');
        videoTrack.onended = stopScreenShare;
      } catch (err) {
        console.error('Error sharing screen', err);
      }
    }

    function stopScreenShare() {
      if (screenStream) {
        screenStream.getTracks().forEach(track => track.stop());
        const videoTrack = localStream.getVideoTracks()[0];

        Object.values(peerConnections).forEach(pc => {
          const sender = pc.getSenders().find(s => s.track.kind === 'video');
          if (sender) {
            sender.replaceTrack(videoTrack);
          }
        });
      }
    }

    // Toggle audio and video
    function toggleAudio() {
      if (localStream) {
        const audioTrack = localStream.getAudioTracks()[0];
        audioTrack.enabled = !audioTrack.enabled; // Toggle audio track
        socket.emit("voice-muted", { userId: socket.id, room });

      }
    }

    async function toggleVideo() {
  if (localStream) {
    const currentVideoTrack = localStream.getVideoTracks()[0];

    if (currentVideoTrack.enabled) {
      // Disable and stop the current video track (turn off the camera)
      currentVideoTrack.enabled = false;
      currentVideoTrack.stop(); // Stop the track to turn off the camera
    } else {
      // If video is disabled, restart the camera
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const newVideoTrack = stream.getVideoTracks()[0];

        // Replace the old video track with the new one
        const sender = localStream.getTracks().find(track => track.kind === 'video');
        if (sender) {
          sender.stop(); // Stop the old track
          localStream.removeTrack(sender); // Remove the old track
        }

        localStream.addTrack(newVideoTrack); // Add the new track

        // Replace the old video track in all peer connections
        for (const userId in peerConnections) {
          const pc = peerConnections[userId];
          const videoSender = pc.getSenders().find(sender => sender.track.kind === 'video');
          if (videoSender) {
            await videoSender.replaceTrack(newVideoTrack); // Replace the old track with the new one in the peer connection
          }
        }

        // Optionally, add the new video stream to the local video grid
       // addVideoStream(localStream, 'You');
      } catch (error) {
        console.error("Error accessing camera:", error);
      }
    }
  }
}
// Function to mute and unmute the speaker (local audio output)
function toggleSpeaker() {
  const videoElement = document.getElementById('videoExpent'); // Ensure this targets your video element

  if (videoElement) {
    // Mute or unmute the speaker by toggling the muted property
    videoElement.muted = !videoElement.muted;

    // You can also update the UI or button text to indicate the current status
    const speakerButton = document.getElementById('speaker-button');
    if (videoElement.muted) {
      speakerButton.textContent = "Unmute Speaker"; // Update button text to indicate mute status
    } else {
      speakerButton.textContent = "Mute Speaker"; // Update button text to indicate unmute status
    }
  }
}

  </script>



  </script>
  <script>
    const nav = document.getElementById("draggableNav");

    let offsetX, offsetY, isDragging = false;

    nav.addEventListener("mousedown", (e) => {
      isDragging = true;
      offsetX = e.clientX - nav.offsetLeft;
      offsetY = e.clientY - nav.offsetTop;
      nav.style.cursor = "grabbing";
    });

    document.addEventListener("mousemove", (e) => {
      if (isDragging) {
        nav.style.left = e.clientX - offsetX + "px";
        nav.style.top = e.clientY - offsetY + "px";
      }
    });

    document.addEventListener("mouseup", () => {
      isDragging = false;
      nav.style.cursor = "grab";
    });




  </script>
</body>

</html>